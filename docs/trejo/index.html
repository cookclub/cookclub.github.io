<!doctype html>
<meta charset="utf-8" />
<title>Trejo’s Tacos Recipes</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="robots" content="noindex" />
<style>
  :root{--fg:#1a1a1a; --sub:#585858; --bg:#fff; --muted:#f6f6f6; --line:#e8e8e8; --accent:#7a5cff;
        --radius:12px; --pad:1rem; --shadow:0 1px 2px rgba(0,0,0,.06)}
  *{box-sizing:border-box}
  body{margin:0; font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial}
  a{color:inherit}
  header{position:sticky; top:0; background:var(--bg); border-bottom:1px solid var(--line); z-index:2}
  .wrap{max-width:980px; margin:0 auto; padding:clamp(.75rem,2vw,1.25rem);}
  .title{font-weight:800; font-size:1.6rem; letter-spacing:.2px}
  .controls{display:flex; gap:.5rem; width:100%; margin-top:.75rem; flex-wrap:wrap}
  .search{flex:1; display:flex; align-items:center; gap:.5rem; background:var(--muted); padding:.625rem .75rem; border-radius:999px}
  .search input{border:0; outline:0; background:transparent; width:100%; font-size:1rem}
  .chip{border:1px solid var(--line); padding:.4rem .65rem; border-radius:999px; background:#fff; cursor:pointer; user-select:none}
  .chip[aria-pressed="true"]{border-color:var(--accent); color:var(--accent)}
  main{padding-block:1rem}
  .grid{display:grid; grid-template-columns:repeat(auto-fill, minmax(220px,1fr)); gap:1rem}
  .card{display:flex; flex-direction:column; gap:.4rem; background:#fff; border:1px solid var(--line); border-radius:var(--radius); padding:var(--pad); box-shadow:var(--shadow)}
  .num{font-size:.8rem; color:var(--sub); background:var(--muted); padding:.2rem .5rem; border-radius:999px; width:max-content}
  .name{font-weight:600; margin-top:.1rem}
  .open{margin-top:auto; font-size:.9rem; color:var(--accent); text-decoration:none}
  .count{color:var(--sub); font-size:.9rem; margin:.75rem 0}
</style>

<header>
  <div class="wrap">
    <div class="title">Trejo’s Tacos Recipes</div>
    <div class="controls">
      <label class="search" aria-label="Search recipes">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M15.8 14.4l4.6 4.6-1.4 1.4-4.6-4.6a7 7 0 1 1 1.4-1.4zM5 10a5 5 0 1 0 10 0A5 5 0 0 0 5 10z" fill="currentColor"/></svg>
        <input id="q" type="search" placeholder="Search by name or number…" autocomplete="off" />
      </label>
      <div role="group" aria-label="Sort">
        <button class="chip" id="sort-num" aria-pressed="true">Sort: Number</button>
        <button class="chip" id="sort-az" aria-pressed="false">A–Z</button>
      </div>
    </div>
  </div>
</header>

<main class="wrap">
  <div class="count" id="count"></div>
  <div class="grid" id="grid" aria-live="polite"></div>
</main>

<script>
(function(){
  const grid = document.getElementById('grid');
  const count = document.getElementById('count');
  const q = document.getElementById('q');
  const sortNum = document.getElementById('sort-num');
  const sortAZ = document.getElementById('sort-az');

  const numFromFile = (file) => (file.match(/^(\d{3})-/)||[])[1] || "";
  const slugify = (s) => s.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'');

  let items = [];

  function render(list){
    grid.innerHTML="";
    list.forEach(it=>{
      const card = document.createElement('article'); card.className='card';
      card.innerHTML = `
        <div class="num">${it.num ? `#${it.num}` : '—'}</div>
        <div class="name">${it.title}</div>
        <a class="open" href="${it.href}">Open →</a>`;
      grid.appendChild(card);
    });
    count.textContent = `${list.length} recipe${list.length===1?"":"s"}`;
  }
  function apply(){
    const term = (q.value||"").trim().toLowerCase();
    let list = items.filter(it=> !term || it.num.includes(term) || it.title.toLowerCase().includes(term));
    if (sortAZ.getAttribute('aria-pressed')==='true') list.sort((a,b)=>a.title.localeCompare(b.title));
    else list.sort((a,b)=>(a.num||"").localeCompare(b.num||""));
    render(list);
  }
  function toggle(on, off){ on.setAttribute('aria-pressed','true'); off.setAttribute('aria-pressed','false'); apply(); }
  sortNum.addEventListener('click', ()=>toggle(sortNum, sortAZ));
  sortAZ.addEventListener('click', ()=>toggle(sortAZ, sortNum));
  q.addEventListener('input', apply);

  async function loadData(){
    // Prefer per-page index, then fall back to recipes.json
    try {
      const r = await fetch('recipes_index.json', {cache:'no-store'});
      if (r.ok) {
        const data = await r.json();
        items = data.map(d => ({ title: d.title, num: numFromFile(d.file), href: 'exports/html/'+d.file }));
        apply(); return;
      }
    } catch {}
    try {
      const r2 = await fetch('exports/recipes.json', {cache:'no-store'});
      if (r2.ok) {
        const data = await r2.json();
        items = data.map((rec, i) => {
          const file = `${String(i+1).padStart(3,'0')}-${slugify(rec.title)}.html`;
          return { title: rec.title, num: String(i+1).padStart(3,'0'), href: 'exports/html/'+file };
        });
        apply(); return;
      }
    } catch {}
    render([]); // nothing found
  }

  loadData();
})();
</script>
